# 验证码识别使用指南

## 🎯 三种识别方式对比

| 方式 | 优点 | 缺点 | 成本 | 推荐指数 |
|-----|------|------|------|---------|
| **手动输入** | 100%准确 | 需要人工参与 | 免费 | ⭐⭐⭐⭐⭐ (测试阶段推荐) |
| **ddddocr** | 离线识别，速度快 | 需要Python环境 | 免费 | ⭐⭐⭐⭐ |
| **2Captcha** | 准确率高，自动化 | 需要付费 | $2.99/1000次 | ⭐⭐⭐⭐ (生产环境推荐) |

---

## 方式1: 手动输入验证码 (推荐新手使用)

### 特点
- ✅ 100%准确，不会识别错误
- ✅ 完全免费
- ✅ 无需额外配置
- ❌ 需要人工参与

### 使用方法

**1. 运行完整版脚本**
```bash
npm run test:lh-full
```

**2. 当看到提示时**
```
📸 验证码已保存到: captcha.png
🔗 或访问: https://www.linkhaitao.com/api2.php?c=verifyCode&a=getCode&t=...

⚠️  请打开 captcha.png 查看验证码图片

👉 请输入验证码 (4位字符):
```

**3. 打开 captcha.png 文件**
- 图片会自动保存在项目目录
- 双击打开查看验证码

**4. 输入验证码**
- 在命令行输入你看到的4位字符
- 按回车确认

**5. 如果识别错误**
- 程序会自动重试
- 最多尝试10次

---

## 方式2: 使用ddddocr自动识别 (适合有Python基础)

### 准备工作

**1. 安装Python**
- 下载: https://www.python.org/downloads/
- 安装时勾选 "Add Python to PATH"

**2. 安装ddddocr库**
```bash
pip install ddddocr
```

**3. 验证安装**
```bash
python ocr_solver.py captcha.png
```

### 配置

打开 `test-linkhaitao-full.js`，修改配置：

```javascript
const CONFIG = {
  username: 'omnilearn',
  password: 'Ltt.104226',
  startDate: '2024-12-01',
  endDate: '2024-12-31',

  captchaMethod: 'ddddocr',  // ⬅️ 改这里
};
```

### 运行
```bash
npm run test:lh-full
```

### 优缺点
- ✅ 全自动，无需人工
- ✅ 免费
- ✅ 离线运行，速度快
- ❌ 准确率约70-80%
- ❌ 需要Python环境

---

## 方式3: 使用2Captcha服务 (适合生产环境)

### 准备工作

**1. 注册2Captcha**
- 官网: https://2captcha.com
- 注册账号并充值 (最低$3)

**2. 获取API Key**
- 登录后台
- 找到 "API Key" 并复制

### 配置

打开 `test-linkhaitao-full.js`，修改配置：

```javascript
const CONFIG = {
  username: 'omnilearn',
  password: 'Ltt.104226',
  startDate: '2024-12-01',
  endDate: '2024-12-31',

  captchaMethod: '2captcha',           // ⬅️ 改这里
  captchaApiKey: '你的2Captcha API Key', // ⬅️ 填写你的Key
};
```

### 运行
```bash
npm run test:lh-full
```

### 费用
- $2.99 / 1000次识别
- 每次登录需要识别1次验证码
- 如果识别错误会自动重试（不额外收费）

### 优缺点
- ✅ 准确率95%+
- ✅ 全自动
- ✅ 稳定可靠
- ❌ 需要付费
- ❌ 需要网络请求（稍慢）

---

## 🎯 推荐使用场景

### 测试阶段 (现在) → 使用**手动输入**
- 免费
- 可以验证整个流程
- 准确率100%

### 开发阶段 → 使用**ddddocr**
- 频繁测试时节省时间
- 免费
- 识别失败可以重试

### 生产环境 → 使用**2Captcha**
- 无需人工干预
- 准确率高
- 稳定性好

---

## 常见问题

**Q: 手动输入时看不清验证码怎么办？**
A: 可以在浏览器中打开URL查看更清晰的图片，或者直接重试获取新的验证码

**Q: ddddocr识别率低怎么办？**
A: LinkHaitao的验证码可能比较复杂，建议切换到手动输入或2Captcha

**Q: 2Captcha识别失败会扣费吗？**
A: 不会，只有识别成功才扣费

**Q: 能不能跳过验证码？**
A: 不能，这是LinkHaitao的安全机制。但可以保存登录后的token，下次直接使用。

**Q: Token有效期多久？**
A: 通常是7-30天，过期后需要重新登录。

---

## 💡 最佳实践

### 方案A: 手动登录一次，保存Token
```javascript
// 第一次手动登录获取token
// 运行: npm run test:lh-full
// 复制输出的token

// 之后直接使用token，跳过登录
const token = '你保存的token';
const data = await fetchCommissionData(token, startDate, endDate);
```

### 方案B: 定时自动登录
- 使用2Captcha自动识别
- 每天凌晨自动采集数据
- 适合生产环境

---

## 🚀 下一步

运行完整版脚本：

```bash
npm run test:lh-full
```

按提示输入验证码，如果成功获取数据，你就可以进入下一阶段了！
