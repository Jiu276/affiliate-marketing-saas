# 产品需求文档 (PRD)
## 联盟营销数据统计分析系统 v3.1

---

## ⚠️ 风险声明
**本系统涉及以下合规风险,使用前请务必评估:**
- 自动化登录和数据抓取可能违反第三方平台服务条款
- 多账号批量管理存在账号封禁风险
- 凭证存储和API密钥管理存在安全隐患
- 建议改用各平台官方API,确保合规性

---

## 1. 产品概述

### 1.1 产品定位
一款面向联盟营销从业者的**多平台数据聚合与ROI分析工具**,用于统一管理和分析来自多个联盟营销平台的广告投放和佣金收益数据。

### 1.2 目标用户
- 跨境电商联盟营销运营人员
- 管理多个联盟账号的营销团队
- 需要精细化ROI分析的广告投放人员

### 1.3 核心价值
- **数据聚合**: 整合4大联盟平台 + Google Ads数据
- **自动化**: 减少90%的人工数据采集时间
- **ROI透明**: 实时计算广告费用与佣金收益比
- **决策支持**: 识别亏损广告系列,优化投放策略

---

## 2. 核心功能模块

### 2.1 多平台自动登录
**支持平台:**
- LinkHaitao (LH) - 海淘联盟平台
- PartnerMatic (PM) - 国际联盟营销平台
- LinkBux (LB) - 链接推广平台
- Rewardoo (RW) - 返利平台

**功能点:**
- 启动时自动预登录所有配置账号
- 支持单平台多账号管理(如LH1/LH2/LH3)
- 验证码自动识别(图像识别算法)
- 登录状态实时反馈

**技术实现:**
- LH平台: Token认证 + MD5签名
- PM平台: JSON API + JWT Token
- LB平台: Cookie认证
- RW平台: Session Cookie

---

### 2.2 广告数据采集

**数据源:** Google Sheets (通过Google Sheets API v4)

**采集内容:**
- 广告系列名称
- 目标国家/地区
- 广告预算与币种
- 日期范围
- 展示次数 (Impressions)
- 点击次数 (Clicks)
- 广告费用 (Cost)
- Google Ads账号信息(MCC/CID)

**配置方式:**
- 从`config.ini`读取多个表格链接
- 支持批量表格数据导入
- 自动解析表格范围(A1:W500)

---

### 2.3 佣金数据采集

**采集维度:**
- 商家ID (MID/MCID)
- 佣金金额 (按商家聚合)
- 订单数量
- 联盟点击数
- 佣金状态 (Pending/Confirmed/Rejected)

**特殊功能:**
- **拒付追踪**: 自动获取近3个月的拒付(Rejected)佣金记录
- **失效佣金**: 标记Expired状态的佣金
- **时间范围**: 支持自定义日期区间查询

**各平台API实现:**
- LH: 报表API (`/api2.php?c=report&a=performance`)
- PM: 性能API (`/report/performance`)
- LB: HTML解析 + 数据提取
- RW: JSON API (`/creator/orders/performance_list`)

---

### 2.4 数据统计与分析

**数据合并逻辑:**
1. 按广告系列聚合广告费用数据
2. 匹配商家MID与联盟简称关联佣金
3. 按日期范围汇总统计

**核心指标计算:**
```
CPC (Cost Per Click) = 广告费用 / 广告点击数
EPC (Earnings Per Click) = 佣金收入 / 广告点击数
ROI (Return on Investment) = (佣金 - 费用) / 费用
CR (Conversion Rate) = 订单数 / 点击数
```

**币种处理:**
- CNY自动转USD (汇率7.15)
- 统一以USD显示

---

### 2.5 数据展示

**统计报表视图:**

| 序号 | 账号 | 广告系列 | 商家MID | 预算 | 展示 | 点击 | 费用 | 佣金 | CPC | EPC | ROI |
|------|------|----------|---------|------|------|------|------|------|-----|-----|-----|
| 自动生成表格数据 |

**可视化特性:**
- ROI < 0 的行标红显示(亏损预警)
- 实时状态提示(数据采集进度)
- 支持按列排序

**汇总统计:**
- 累计广告费
- 累计佣金
- 平均ROI
- 统计天数

---

### 2.6 辅助功能

**日期快捷选择:**
- 最近7天 (默认)
- 最近30天
- 自定义日期范围

**数据导出:**
- 导出为Excel格式 (.xlsx)
- 文件命名: `开始日期-结束日期.xlsx`
- 保存路径: `\log\` 目录

**日志记录:**
- 自动创建日志目录
- 记录操作历史

---

## 3. 数据模型

### 3.1 统计数据结构
```
统计数据 {
    账号mcc: 文本      // Google Ads MCC账号
    账号cid: 文本      // Google Ads CID
    广告系列: 文本      // Campaign名称
    商家mid: 文本      // 商家唯一标识
    联盟: 文本         // LH/PM/LB/RW
    国家: 文本         // 国家代码
    预算: 文本         // 预算金额
    币种: 文本         // USD/CNY
    日期: 文本         // YYYY-MM-DD
    展示: 文本         // Impressions
    广告点击: 文本     // Ad Clicks
    联盟点击: 文本     // Affiliate Clicks
    费用: 文本         // Cost
    佣金: 文本         // Commission
    佣金失效: 文本     // Expired Commission
    佣金状态: 文本     // Pending/Confirmed/Rejected
    订单: 文本         // Order Count
}
```

### 3.2 登录数据结构
```
登录数据 {
    lmname: 文本      // 联盟简称 (LH1/PM2...)
    lmurl: 文本       // 平台域名
    user: 文本        // 用户名/邮箱
    pass: 文本        // 密码
    token: 文本       // 访问令牌
    cookies: 文本     // Cookie字符串
}
```

### 3.3 佣金记录结构
```
佣金记录 {
    联盟简称: 文本
    商家编号: 文本
    商家名称: 文本
    订单日期: 日期时间型
    佣金金额: 小数型
    佣金类型: 文本    // Pending/Rejected/Confirmed
}
```

---

## 4. 用户使用流程

### 4.1 系统初始化
```
启动程序
    ↓
读取config.ini配置
    ↓
自动登录所有联盟账号
    ↓
显示登录状态反馈
```

### 4.2 数据统计流程
```
选择日期范围
    ↓
点击"数据统计"按钮
    ↓
[并行执行]
    ├─ 从Google Sheets获取广告数据
    ├─ 从LH平台获取佣金数据
    ├─ 从PM平台获取佣金数据
    ├─ 从LB平台获取佣金数据
    └─ 从RW平台获取佣金数据
    ↓
数据合并与指标计算
    ↓
生成统计报表
    ↓
[可选] 导出Excel
```

---

## 5. 配置文件结构

### 5.1 config.ini 示例
```ini
[ml]
scml=用户名标识

[aff]
LH1=用户名$$密码
PM1=用户名$$密码
LB1=用户名$$密码
RW1=用户名$$密码

[mcc]
账号1=表格链接$$账号标识
账号2=表格链接$$账号标识
```

---

## 6. 技术架构要点

### 6.1 关键技术
- **开发语言**: 易语言 (EPL)
- **UI框架**: 超级列表框 + 日期选择器
- **网络请求**: HTTP/HTTPS (支持自定义Header)
- **数据解析**: JSON解析库
- **图像识别**: 内置验证码识别模块
- **加密算法**: MD5签名验证

### 6.2 安全机制
⚠️ **当前存在的问题:**
- Google API Key硬编码在代码中
- 登录凭证明文存储在INI文件
- 无数据传输加密
- 无操作审计日志

🔐 **建议改进方案:**
- 使用环境变量或密钥管理服务
- 凭证加密存储
- 启用HTTPS双向认证
- 添加操作日志记录

---

## 7. 性能指标

### 7.1 数据容量
- 单次查询: 最多2000条记录/平台
- Google Sheets: 支持A1:W500范围(约500行)
- 导出Excel: 无行数限制

### 7.2 响应时间
- 单平台登录: 3-10秒 (含验证码识别)
- 数据采集: 5-30秒 (取决于账号数量)
- 报表生成: 1-5秒

---

## 8. 已知限制与风险

### 8.1 技术限制
- 仅支持Windows平台
- 需要.NET Framework支持
- 验证码识别准确率约85-90%
- 网络故障会导致数据采集失败

### 8.2 合规风险
❌ **高风险行为:**
- 模拟登录可能触发平台风控
- 批量数据抓取可能被识别为机器人
- 多账号管理可能违反平台规则

✅ **合规建议:**
- 与各平台沟通获取数据授权
- 使用官方API替代网页抓取
- 限制请求频率避免触发限流
- 遵守各平台服务条款

### 8.3 数据准确性
- 汇率固定为7.15,需定期更新
- 拒付佣金仅回溯3个月
- 不同平台数据更新延迟不同

---

## 9. 未来优化方向

### 9.1 功能扩展
- [ ] 增加更多联盟平台支持
- [ ] 实时监控与告警(ROI异常)
- [ ] 历史数据趋势分析
- [ ] 自动化广告优化建议
- [ ] 移动端数据查看

### 9.2 技术升级
- [ ] 迁移到现代技术栈(Python/Node.js)
- [ ] 云端部署支持多用户
- [ ] 数据库持久化(替代内存数组)
- [ ] 使用官方API替代爬虫
- [ ] 实现OAuth2.0统一认证

### 9.3 用户体验
- [ ] 添加数据可视化图表
- [ ] 支持自定义报表模板
- [ ] 增加数据筛选和搜索
- [ ] 批量操作支持
- [ ] 多语言界面

---

## 10. 成功指标 (KPI)

- **时间节省**: 数据采集时间从2小时降至5分钟
- **准确性**: 数据准确率 > 95%
- **覆盖率**: 支持80%主流联盟平台
- **稳定性**: 连续运行7天无崩溃
- **用户满意度**: NPS > 8分

---

## 附录

### A. 相关文档
- 易语言开发环境配置指南
- 各联盟平台API文档链接
- Google Sheets API使用说明

### B. 常见问题
**Q: 验证码识别失败怎么办?**
A: 系统会自动重试10次,如仍失败需检查验证码识别库是否正常。

**Q: 数据不匹配怎么办?**
A: 检查广告系列命名规则(格式: XX-联盟-MID),确保与配置一致。

**Q: 支持哪些联盟?**
A: 当前支持LH/PM/LB/RW,其他平台需定制开发。

---

## 文档变更历史

| 版本 | 日期 | 修订内容 | 作者 |
|------|------|----------|------|
| v1.0 | 2025-10-12 | 初始版本 | PRD Team |

---

**文档状态**: 草稿
**下一步**: 评审合规性风险 → 确定是否继续开发

---

> **重要提醒**: 本PRD基于现有源码逆向分析生成,实际使用前必须解决合规性和安全性问题。建议优先考虑使用官方API构建合规系统。
