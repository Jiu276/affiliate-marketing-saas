<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>联盟营销数据采集系统</title>
  <link rel="stylesheet" href="style-v2.css">
</head>
<body>
  <!-- 登录/注册页面 -->
  <div id="authSection" class="auth-container">
    <div class="auth-card">
      <header class="auth-header">
        <h1>联盟营销数据采集系统</h1>
        <p class="subtitle">多用户SaaS版本</p>
      </header>

      <div class="auth-tabs">
        <button class="tab-btn active" onclick="showTab('login', event)">登录</button>
        <button class="tab-btn" onclick="showTab('register', event)">注册</button>
      </div>

      <!-- 登录表单 -->
      <div id="loginTab" class="tab-content active">
        <form id="loginForm">
          <div class="form-group">
            <label>邮箱:</label>
            <input type="email" id="loginEmail" placeholder="your@email.com" required>
          </div>
          <div class="form-group">
            <label>密码:</label>
            <input type="password" id="loginPassword" placeholder="输入密码" required>
          </div>
          <button type="submit" class="btn-primary">登录</button>
        </form>
        <div id="loginStatus" class="status-message"></div>
      </div>

      <!-- 注册表单 -->
      <div id="registerTab" class="tab-content">
        <form id="registerForm">
          <div class="form-group">
            <label>用户名:</label>
            <input type="text" id="registerUsername" placeholder="输入用户名" required>
          </div>
          <div class="form-group">
            <label>邮箱:</label>
            <input type="email" id="registerEmail" placeholder="your@email.com" required>
          </div>
          <div class="form-group">
            <label>密码:</label>
            <input type="password" id="registerPassword" placeholder="至少6位" minlength="6" required>
          </div>
          <button type="submit" class="btn-primary">注册</button>
        </form>
        <div id="registerStatus" class="status-message"></div>
      </div>
    </div>
  </div>

  <!-- 主应用页面（带侧边栏） -->
  <div id="appSection" class="app-layout" style="display: none;">
    <!-- 左侧边栏 -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2 class="logo">数据采集</h2>
      </div>

      <nav class="sidebar-nav">
        <a href="#" class="nav-item active" onclick="showSection('dashboard', event)">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M3 4C3 3.44772 3.44772 3 4 3H7C7.55228 3 8 3.44772 8 4V7C8 7.55228 7.55228 8 7 8H4C3.44772 8 3 7.55228 3 7V4Z" stroke="currentColor" stroke-width="1.5"/>
            <path d="M3 13C3 12.4477 3.44772 12 4 12H7C7.55228 12 8 12.4477 8 13V16C8 16.5523 7.55228 17 7 17H4C3.44772 17 3 16.5523 3 16V13Z" stroke="currentColor" stroke-width="1.5"/>
            <path d="M12 4C12 3.44772 12.4477 3 13 3H16C16.5523 3 17 3.44772 17 4V7C17 7.55228 16.5523 8 16 8H13C12.4477 8 12 7.55228 12 7V4Z" stroke="currentColor" stroke-width="1.5"/>
            <path d="M12 13C12 12.4477 12.4477 12 13 12H16C16.5523 12 17 12.4477 17 13V16C17 16.5523 16.5523 17 16 17H13C12.4477 17 12 16.5523 12 16V13Z" stroke="currentColor" stroke-width="1.5"/>
          </svg>
          <span>数据采集</span>
        </a>

        <a href="#" class="nav-item" onclick="showSection('accounts', event)">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M4 6C4 4.89543 4.89543 4 6 4H14C15.1046 4 16 4.89543 16 6V14C16 15.1046 15.1046 16 14 16H6C4.89543 16 4 15.1046 4 14V6Z" stroke="currentColor" stroke-width="1.5"/>
            <path d="M8 8H12M8 12H10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <span>平台账号</span>
        </a>

        <a href="#" class="nav-item" onclick="showSection('sheets', event)">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M5 3C4.44772 3 4 3.44772 4 4V16C4 16.5523 4.44772 17 5 17H15C15.5523 17 16 16.5523 16 16V7L12 3H5Z" stroke="currentColor" stroke-width="1.5"/>
            <path d="M8 10H12M8 13H12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <span>谷歌表格</span>
        </a>
      </nav>

      <div class="sidebar-footer">
        <div class="user-info">
          <div class="user-avatar">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="1.5"/>
              <path d="M10 6V10L12 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="user-details">
            <div class="user-name" id="currentUser">用户</div>
            <button onclick="logout()" class="logout-btn">退出</button>
          </div>
        </div>
      </div>
    </aside>

    <!-- 主内容区 -->
    <main class="main-content">
      <div class="content-header">
        <h1 id="pageTitle">数据采集</h1>
      </div>

      <!-- 数据采集面板 -->
      <div id="dashboardSection" class="content-section">
        <div class="card" id="collectSection" style="display: none;">
          <h2>开始采集数据</h2>

          <form id="collectForm">
            <div class="form-row">
              <div class="form-group">
                <label>开始日期:</label>
                <input type="date" id="startDate" required>
              </div>
              <div class="form-group">
                <label>结束日期:</label>
                <input type="date" id="endDate" required>
              </div>
            </div>
            <button type="submit" class="btn-primary">
              <span id="collectBtnText">开始采集</span>
              <span id="collectSpinner" class="spinner" style="display: none;"></span>
            </button>
          </form>

          <div id="collectStatus" class="status-message"></div>

          <!-- 统计卡片 -->
          <div id="statsSection" style="display: none;">
            <h3>数据统计</h3>
            <div class="stats-cards">
              <div class="stat-card">
                <div class="stat-label">订单总数</div>
                <div class="stat-value" id="totalOrders">0</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">订单总额</div>
                <div class="stat-value" id="totalAmount">$0</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">总佣金</div>
                <div class="stat-value" id="totalCommission">$0</div>
              </div>
            </div>
          </div>

          <!-- 商家汇总表格 -->
          <div id="merchantSection" style="display: none;">
            <h3>商家汇总</h3>
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>排名</th>
                    <th>广告系列</th>
                    <th>商家ID</th>
                    <th>预算</th>
                    <th>展示</th>
                    <th>点击</th>
                    <th>广告费</th>
                    <th>订单数</th>
                    <th>总佣金</th>
                    <th>CR</th>
                    <th>EPC</th>
                    <th>CPC</th>
                    <th>ROI</th>
                  </tr>
                </thead>
                <tbody id="merchantTableBody">
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- 平台账号管理面板 -->
      <div id="accountsSection" class="content-section" style="display: none;">
        <div class="card">
          <div class="card-header">
            <h2>平台账号管理</h2>
            <button onclick="showAddAccountModal()" class="btn-primary">+ 添加账号</button>
          </div>

          <div id="accountsList">
            <!-- 账号列表动态生成 -->
          </div>
        </div>
      </div>

      <!-- Google表格管理面板 -->
      <div id="sheetsSection" class="content-section" style="display: none;">
        <div class="card">
          <div class="card-header">
            <h2>Google表格管理</h2>
            <button onclick="showAddGoogleSheetModal()" class="btn-primary">+ 添加表格</button>
          </div>

          <div id="googleSheetsList">
            <!-- 表格列表动态生成 -->
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- 添加账号弹窗 -->
  <div id="addAccountModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeAddAccountModal()">&times;</span>
      <h2>添加平台账号</h2>
      <form id="addAccountForm">
        <div class="form-group">
          <label>平台:</label>
          <select id="platformSelect" required onchange="toggleApiTokenField()">
            <option value="linkhaitao">LinkHaitao</option>
            <option value="partnermatic">PartnerMatic</option>
            <option value="linkbux">LinkBux</option>
            <option value="rewardoo">Rewardoo</option>
          </select>
        </div>
        <div class="form-group">
          <label>账号名称:</label>
          <input type="text" id="accountName" placeholder="平台登录用户名或标识" required>
        </div>
        <div class="form-group" id="passwordGroup">
          <label>账号密码:</label>
          <input type="password" id="accountPassword" placeholder="平台登录密码">
          <small>某些平台需要密码进行自动登录</small>
        </div>
        <div class="form-group" id="apiTokenGroup" style="display: none;">
          <label>API Token:</label>
          <input type="text" id="apiToken" placeholder="API Token（在平台后台获取）">
          <small id="apiTokenHint">LinkBux、Rewardoo、LinkHaitao和PartnerMatic平台使用API Token采集，无需密码</small>
        </div>
        <div class="form-group">
          <label>联盟序号（可选）:</label>
          <input type="text" id="affiliateName" placeholder="例如: LH1, PM1, PM4, LB1" maxlength="10">
          <small>用于区分同平台的多个账号，如 LH1、LH2、PM1、LB1 等</small>
        </div>
        <button type="submit" class="btn-primary">添加</button>
      </form>
      <div id="addAccountStatus" class="status-message"></div>
    </div>
  </div>

  <!-- 添加Google表格弹窗 -->
  <div id="addGoogleSheetModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeAddGoogleSheetModal()">&times;</span>
      <h2>添加Google表格</h2>
      <form id="addGoogleSheetForm">
        <div class="form-group">
          <label>表格名称:</label>
          <input type="text" id="sheetName" placeholder="例如: 12月广告数据" required>
        </div>
        <div class="form-group">
          <label>表格URL:</label>
          <input type="url" id="sheetUrl" placeholder="https://docs.google.com/spreadsheets/d/..." required>
          <small>提示: 请确保表格已设置为"任何人可查看"</small>
        </div>
        <div class="form-group">
          <label>备注（可选）:</label>
          <input type="text" id="sheetDescription" placeholder="例如: Google Ads搜索广告数据">
        </div>
        <button type="submit" class="btn-primary">添加</button>
      </form>
      <div id="addGoogleSheetStatus" class="status-message"></div>
    </div>
  </div>

  <script src="app-v2.js"></script>
</body>
</html>
