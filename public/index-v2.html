<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>联盟营销数据采集系统 - 多用户版</title>
  <link rel="stylesheet" href="style-v2.css">
</head>
<body>
  <div class="container">
    <!-- 登录/注册页面 -->
    <div id="authSection" class="section">
      <header>
        <h1>🚀 联盟营销数据采集系统</h1>
        <p class="subtitle">多用户SaaS版本</p>
      </header>

      <div class="auth-tabs">
        <button class="tab-btn active" onclick="showTab('login')">登录</button>
        <button class="tab-btn" onclick="showTab('register')">注册</button>
      </div>

      <!-- 登录表单 -->
      <div id="loginTab" class="tab-content active">
        <form id="loginForm">
          <div class="form-group">
            <label>邮箱:</label>
            <input type="email" id="loginEmail" placeholder="your@email.com" required>
          </div>
          <div class="form-group">
            <label>密码:</label>
            <input type="password" id="loginPassword" placeholder="输入密码" required>
          </div>
          <button type="submit" class="btn-primary">登录</button>
        </form>
        <div id="loginStatus" class="status-message"></div>
      </div>

      <!-- 注册表单 -->
      <div id="registerTab" class="tab-content">
        <form id="registerForm">
          <div class="form-group">
            <label>用户名:</label>
            <input type="text" id="registerUsername" placeholder="输入用户名" required>
          </div>
          <div class="form-group">
            <label>邮箱:</label>
            <input type="email" id="registerEmail" placeholder="your@email.com" required>
          </div>
          <div class="form-group">
            <label>密码:</label>
            <input type="password" id="registerPassword" placeholder="至少6位" minlength="6" required>
          </div>
          <button type="submit" class="btn-primary">注册</button>
        </form>
        <div id="registerStatus" class="status-message"></div>
      </div>
    </div>

    <!-- 主应用页面 -->
    <div id="appSection" style="display: none;">
      <header>
        <h1>📊 数据采集管理</h1>
        <div class="user-bar">
          <span>👤 <strong id="currentUser"></strong></span>
          <button onclick="logout()" class="btn-secondary">退出</button>
        </div>
      </header>

      <div class="section">
        <!-- 平台账号管理 -->
        <div class="card">
          <h2>🔑 平台账号管理</h2>

          <div id="accountsList">
            <!-- 账号列表动态生成 -->
          </div>

          <button onclick="showAddAccountModal()" class="btn-primary">+ 添加平台账号</button>
        </div>

        <!-- Google表格管理 -->
        <div class="card">
          <h2>📊 Google表格管理</h2>

          <div id="googleSheetsList">
            <!-- 表格列表动态生成 -->
          </div>

          <button onclick="showAddGoogleSheetModal()" class="btn-primary">+ 添加Google表格</button>
        </div>

        <!-- 数据采集 -->
        <div class="card" id="collectSection" style="display: none;">
          <h2>📥 数据采集</h2>

          <form id="collectForm">
            <div class="form-row">
              <div class="form-group">
                <label>开始日期:</label>
                <input type="date" id="startDate" required>
              </div>
              <div class="form-group">
                <label>结束日期:</label>
                <input type="date" id="endDate" required>
              </div>
            </div>
            <button type="submit" class="btn-primary">
              <span id="collectBtnText">开始采集</span>
              <span id="collectSpinner" class="spinner" style="display: none;"></span>
            </button>
          </form>

          <div id="collectStatus" class="status-message"></div>

          <!-- 统计卡片 -->
          <div id="statsSection" style="display: none;">
            <h3>📊 数据统计</h3>
            <div class="stats-cards">
              <div class="stat-card">
                <div class="stat-label">订单总数</div>
                <div class="stat-value" id="totalOrders">0</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">订单总额</div>
                <div class="stat-value" id="totalAmount">$0</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">总佣金</div>
                <div class="stat-value" id="totalCommission">$0</div>
              </div>
            </div>
          </div>

          <!-- 商家汇总表格 -->
          <div id="merchantSection" style="display: none;">
            <h3>💼 商家汇总</h3>
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>排名</th>
                    <th>商家名称</th>
                    <th>商家ID</th>
                    <th>订单数</th>
                    <th>订单总额</th>
                    <th>总佣金</th>
                    <th>待确认</th>
                    <th>已确认</th>
                    <th>已拒付</th>
                  </tr>
                </thead>
                <tbody id="merchantTableBody">
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 添加账号弹窗 -->
  <div id="addAccountModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeAddAccountModal()">&times;</span>
      <h2>添加平台账号</h2>
      <form id="addAccountForm">
        <div class="form-group">
          <label>平台:</label>
          <select id="platformSelect" required>
            <option value="linkhaitao">LinkHaitao</option>
            <option value="partnermatic">PartnerMatic</option>
          </select>
        </div>
        <div class="form-group">
          <label>账号名称:</label>
          <input type="text" id="accountName" placeholder="平台登录用户名" required>
        </div>
        <div class="form-group">
          <label>账号密码:</label>
          <input type="password" id="accountPassword" placeholder="平台登录密码" required>
        </div>
        <div class="form-group">
          <label>联盟序号（可选）:</label>
          <input type="text" id="affiliateName" placeholder="例如: LH1, PM1, PM4" maxlength="10">
          <small style="color: #999; display: block; margin-top: 5px;">
            用于区分同平台的多个账号，如 LH1、LH2、PM1 等
          </small>
        </div>
        <button type="submit" class="btn-primary">添加</button>
      </form>
      <div id="addAccountStatus" class="status-message"></div>
    </div>
  </div>

  <!-- 添加Google表格弹窗 -->
  <div id="addGoogleSheetModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeAddGoogleSheetModal()">&times;</span>
      <h2>添加Google表格</h2>
      <form id="addGoogleSheetForm">
        <div class="form-group">
          <label>表格名称:</label>
          <input type="text" id="sheetName" placeholder="例如: 12月广告数据" required>
        </div>
        <div class="form-group">
          <label>表格URL:</label>
          <input type="url" id="sheetUrl" placeholder="https://docs.google.com/spreadsheets/d/..." required>
          <small style="color: #999; display: block; margin-top: 5px;">
            提示: 请确保表格已设置为"任何人可查看"
          </small>
        </div>
        <div class="form-group">
          <label>备注（可选）:</label>
          <input type="text" id="sheetDescription" placeholder="例如: Google Ads搜索广告数据">
        </div>
        <button type="submit" class="btn-primary">添加</button>
      </form>
      <div id="addGoogleSheetStatus" class="status-message"></div>
    </div>
  </div>

  <script src="app-v2.js"></script>
</body>
</html>
