.版本 2
.支持库 iext
.支持库 spec

.程序集 窗口程序集_启动窗口
.程序集变量 登录数组, 登录数据, , "0"
.程序集变量 集_广告数组, 统计数据, , "0"
.程序集变量 数据库路径, 文本型
.程序集变量 sql, 文本型
.程序集变量 集_配置项, 类_配置项
.程序集变量 集_array, 通用型, , "0"

.子程序 __启动窗口_创建完毕
.局部变量 数组1, 统计数据, , "0"
.局部变量 数组2, 统计数据, , "0"
.局部变量 数组3, 文本型, , "0"
.局部变量 user, 文本型
.局部变量 demo, 文本型

加载皮肤 (23)
超级列表框明细报表.可视 ＝ 假
日期框开始.今天 ＝ 增减时间 (取现行时间 (), #日, -7)
日期框结束.今天 ＝ 增减时间 (取现行时间 (), #日, -1)
日期框_格式化 (日期框开始, “yyyy-MM-dd”)
日期框_格式化 (日期框结束, “yyyy-MM-dd”)
user ＝ 集_配置项.读项文本 (取运行目录 () ＋ “\config.ini”, “ml”, “scml”, , )
_启动窗口.标题 ＝ “统计报表v3.1 by ” ＋ user
取联盟登录信息 (登录数组)
demo ＝ 预登录海淘系平台 (登录数组)
透明标签1.标题 ＝ “状态：” ＋ demo
目录_创建 (取运行目录 () ＋ “\log\”)


' 取点击数组到数据库 (数组1)
' 提示 (“谷歌表格数据已入库”, )



.子程序 取谷歌表格数据
.参数 参_统计数组, 统计数据, 参考 数组
.局部变量 局_项数组s, 文本型, , "0"
.局部变量 局_值数组s, 文本型, , "0"
.局部变量 局_计次, 整数型
.局部变量 局_表格文本s, 文本型, , "0"
.局部变量 局_表格数据, 文本型

集_配置项.枚举项 (取运行目录 () ＋ “\config.ini”, “mcc”, 局_项数组s, 局_值数组s, )
清除数组 (参_统计数组)
.计次循环首 (取数组成员数 (局_值数组s), 局_计次)
    局_表格文本s ＝ 分割文本 (局_值数组s [局_计次], “$$”, )
    局_表格数据 ＝ 表格_获取数据 (局_表格文本s [1], “A1:W500”)
    取表格数据到数组 (局_表格数据, 局_项数组s [局_计次], 参_统计数组)
.计次循环尾 ()
返回 ()




.子程序 取联盟登录信息
.参数 参_登录数组, 登录数据, 参考 数组
.局部变量 局_项数组s, 文本型, , "0"
.局部变量 局_值数组s, 文本型, , "0"
.局部变量 局_登录, 登录数据
.局部变量 局_计次, 整数型
.局部变量 局_表格文本s, 文本型, , "0"

集_配置项.枚举项 (取运行目录 () ＋ “\config.ini”, “aff”, 局_项数组s, 局_值数组s, )
清除数组 (参_登录数组)
.计次循环首 (取数组成员数 (局_值数组s), 局_计次)
    局_表格文本s ＝ 分割文本 (局_值数组s [局_计次], “$$”, )
    局_登录.lmurl ＝ “”
    .判断开始 (到大写 (局_项数组s [局_计次]) ＝ “LH1”)
        局_登录.lmname ＝ “LH1”
        局_登录.lmurl ＝ “linkhaitao.com”
        局_登录.user ＝ 局_表格文本s [1]
        局_登录.pass ＝ 局_表格文本s [2]
    .判断 (到大写 (局_项数组s [局_计次]) ＝ “LH2”)
        局_登录.lmname ＝ “LH2”
        局_登录.lmurl ＝ “linkhaitao.com”
        局_登录.user ＝ 局_表格文本s [1]
        局_登录.pass ＝ 局_表格文本s [2]
    .判断 (到大写 (局_项数组s [局_计次]) ＝ “LH3”)
        局_登录.lmname ＝ “LH3”
        局_登录.lmurl ＝ “linkhaitao.com”
        局_登录.user ＝ 局_表格文本s [1]
        局_登录.pass ＝ 局_表格文本s [2]
    .判断 (到大写 (局_项数组s [局_计次]) ＝ “PM1”)
        局_登录.lmname ＝ “PM1”
        局_登录.lmurl ＝ “partnermatic.com”
        局_登录.user ＝ 局_表格文本s [1]
        局_登录.pass ＝ 局_表格文本s [2]
    .判断 (到大写 (局_项数组s [局_计次]) ＝ “PM2”)
        局_登录.lmname ＝ “PM2”
        局_登录.lmurl ＝ “partnermatic.com”
        局_登录.user ＝ 局_表格文本s [1]
        局_登录.pass ＝ 局_表格文本s [2]
    .判断 (到大写 (局_项数组s [局_计次]) ＝ “PM3”)
        局_登录.lmname ＝ “PM3”
        局_登录.lmurl ＝ “partnermatic.com”
        局_登录.user ＝ 局_表格文本s [1]
        局_登录.pass ＝ 局_表格文本s [2]
    .判断 (到大写 (局_项数组s [局_计次]) ＝ “LB1”)
        局_登录.lmname ＝ “LB1”
        局_登录.lmurl ＝ “linkbux.com”
        局_登录.user ＝ 局_表格文本s [1]
        局_登录.pass ＝ 局_表格文本s [2]
    .判断 (到大写 (局_项数组s [局_计次]) ＝ “LB2”)
        局_登录.lmname ＝ “LB2”
        局_登录.lmurl ＝ “linkbux.com”
        局_登录.user ＝ 局_表格文本s [1]
        局_登录.pass ＝ 局_表格文本s [2]
    .判断 (到大写 (局_项数组s [局_计次]) ＝ “LB3”)
        局_登录.lmname ＝ “LB3”
        局_登录.lmurl ＝ “linkbux.com”
        局_登录.user ＝ 局_表格文本s [1]
        局_登录.pass ＝ 局_表格文本s [2]
    .判断 (到大写 (局_项数组s [局_计次]) ＝ “RW1”)
        局_登录.lmname ＝ “RW1”
        局_登录.lmurl ＝ “rewardoo.com”
        局_登录.user ＝ 局_表格文本s [1]
        局_登录.pass ＝ 局_表格文本s [2]
    .判断 (到大写 (局_项数组s [局_计次]) ＝ “RW2”)
        局_登录.lmname ＝ “RW2”
        局_登录.lmurl ＝ “rewardoo.com”
        局_登录.user ＝ 局_表格文本s [1]
        局_登录.pass ＝ 局_表格文本s [2]
    .判断 (到大写 (局_项数组s [局_计次]) ＝ “RW3”)
        局_登录.lmname ＝ “RW3”
        局_登录.lmurl ＝ “rewardoo.com”
        局_登录.user ＝ 局_表格文本s [1]
        局_登录.pass ＝ 局_表格文本s [2]
    .默认

    .判断结束

    .如果真 (局_登录.lmurl ≠ “”)
        加入成员 (参_登录数组, 局_登录)
    .如果真结束

.计次循环尾 ()
返回 ()




.子程序 预登录海淘系平台, 文本型, , 软件启动就登录
.参数 参_登录数组, 登录数据, 参考 数组
.局部变量 i1, 整数型
.局部变量 token, 文本型
.局部变量 cookie, 文本型
.局部变量 user, 文本型
.局部变量 url, 文本型
.局部变量 data, 文本型
.局部变量 resp, 文本型
.局部变量 提示词, 文本型

.计次循环首 (取数组成员数 (参_登录数组), i1)
    .判断开始 (寻找文本 (参_登录数组 [i1].lmurl, “linkhaitao.com”, , 假) ＞ 0)
        token ＝ 登录_LH (参_登录数组 [i1].user, 参_登录数组 [i1].pass)
        参_登录数组 [i1].token ＝ token
        .如果 (token ≠ “”)
            提示词 ＝ 提示词 ＋ 参_登录数组 [i1].user ＋ “登录LH成功，”

        .否则

            提示词 ＝ 提示词 ＋ 参_登录数组 [i1].user ＋ “登录LH失败，”

        .如果结束


    .判断 (寻找文本 (参_登录数组 [i1].lmurl, “partnermatic.com”, , 假) ＞ 0)
        token ＝ 登录_PM (参_登录数组 [i1].user, 参_登录数组 [i1].pass)
        参_登录数组 [i1].token ＝ token
        .如果 (token ≠ “”)
            提示词 ＝ 提示词 ＋ 参_登录数组 [i1].user ＋ “登录PM成功，”
        .否则

            提示词 ＝ 提示词 ＋ 参_登录数组 [i1].user ＋ “登录PM失败，”

        .如果结束


    .判断 (寻找文本 (参_登录数组 [i1].lmurl, “linkbux.com”, , 假) ＞ 0)
        cookie ＝ 登录_LB (参_登录数组 [i1].user, 参_登录数组 [i1].pass)
        参_登录数组 [i1].cookies ＝ cookie
        .如果 (cookie ≠ “”)
            提示词 ＝ 提示词 ＋ 参_登录数组 [i1].user ＋ “登录LB成功，”
        .否则

            提示词 ＝ 提示词 ＋ 参_登录数组 [i1].user ＋ “登录LB失败，”
        .如果结束

    .判断 (寻找文本 (参_登录数组 [i1].lmurl, “rewardoo.com”, , 假) ＞ 0)
        cookie ＝ 登录_RW (参_登录数组 [i1].user, 参_登录数组 [i1].pass)
        参_登录数组 [i1].cookies ＝ cookie
        .如果 (cookie ≠ “”)
            提示词 ＝ 提示词 ＋ 参_登录数组 [i1].user ＋ “登录RW成功，”
        .否则

            提示词 ＝ 提示词 ＋ 参_登录数组 [i1].user ＋ “登录RW失败，”
        .如果结束


    .默认


    .判断结束

.计次循环尾 ()
返回 (取文本左边 (提示词, 取文本长度 (提示词) － 1))




.子程序 登录_LH, 文本型
.参数 user, 文本型
.参数 pass, 文本型
.局部变量 json, 类_json
.局部变量 header, 文本型
.局部变量 url, 文本型
.局部变量 data, 文本型
.局部变量 i1, 整数型
.局部变量 resp, 文本型
.局部变量 auth_token, 文本型
.局部变量 t, 文本型
.局部变量 bin, 字节集
.局部变量 code, 文本型
.局部变量 sign, 文本型
.局部变量 remember, 文本型

.计次循环首 (10, )
    t ＝ 时间_取现行时间戳 ()
    url ＝ “https://www.linkhaitao.com/api2.php?c=verifyCode&a=getCode&t=” ＋ t
    bin ＝ 网页_访问_对象 (url, , , , , , , , , , , , , , , , , , )
    init (6)

    code ＝ identify (bin, 取字节集长度 (bin))
    .如果真 (取文本长度 (code) ＝ 4)
        跳出循环 ()
    .如果真结束

.计次循环尾 ()
remember ＝ “1”
sign ＝ getSign (user ＋ pass ＋ code ＋ remember ＋ t)
url ＝ “https://www.linkhaitao.com/api2.php?c=login&a=login”
data ＝ “sign=” ＋ sign ＋ “&uname=” ＋ 编码_URL编码 (user, 真, 真) ＋ “&password=” ＋ 编码_URL编码 (pass, 真, 真) ＋ “&code=” ＋ code ＋ “&remember=” ＋ remember ＋ “&t=” ＋ t
resp ＝ 网页_访问S (url, 1, data, , , , , , , , , , , , , , , , , , )
.如果真 (寻找文本 (resp, #lhsuc, , 假) ＞ 0)
    json.解析 (resp, , )
    auth_token ＝ json.取通用属性 (“payload.auth_token”, )
    返回 (auth_token)
.如果真结束
调试输出 (resp)
返回 (“”)



.子程序 登录_PM, 文本型
.参数 user, 文本型
.参数 pass, 文本型
.局部变量 json, 类_json
.局部变量 header, 文本型
.局部变量 url, 文本型
.局部变量 data, 文本型
.局部变量 i1, 整数型
.局部变量 resp, 文本型
.局部变量 auth_token, 文本型

header ＝ “content-type: application/json”
url ＝ “https://api.partnermatic.com/auth/sign_in”
data ＝ “{” ＋ #引号 ＋ “appId” ＋ #引号 ＋ “:32,” ＋ #引号 ＋ “req” ＋ #引号 ＋ “:{” ＋ #引号 ＋ “header” ＋ #引号 ＋ “:{” ＋ #引号 ＋ “token” ＋ #引号 ＋ “:” ＋ #引号 ＋ “” ＋ #引号 ＋ “},” ＋ #引号 ＋ “fields” ＋ #引号 ＋ “:[],” ＋ #引号 ＋ “attributes” ＋ #引号 ＋ “:{},” ＋ #引号 ＋ “filter” ＋ #引号 ＋ “:{” ＋ #引号 ＋ “platform_code” ＋ #引号 ＋ “:” ＋ #引号 ＋ “” ＋ #引号 ＋ “,” ＋ #引号 ＋ “account” ＋ #引号 ＋ “:” ＋ #引号 ＋ user ＋ #引号 ＋ “,” ＋ #引号 ＋ “password” ＋ #引号 ＋ “:” ＋ #引号 ＋ pass ＋ #引号 ＋ “}}}”
resp ＝ 网页_访问S (url, 1, data, , , header, , , , , , , , , , , , , , , )
.如果真 (寻找文本 (resp, #pmsuc, , 假) ＞ 0)
    json.解析 (resp, , )
    auth_token ＝ json.取通用属性 (“data.auth_token”, )
    返回 (auth_token)
.如果真结束
调试输出 (resp)
返回 (“”)



.子程序 登录_RW, 文本型, , cookie自带用户名，返回cookie即可
.参数 user, 文本型
.参数 pass, 文本型
.局部变量 json, 类_json
.局部变量 header, 文本型
.局部变量 url, 文本型
.局部变量 data, 文本型
.局部变量 i1, 整数型
.局部变量 resp, 文本型
.局部变量 auth_token, 文本型
.局部变量 cookie, 文本型

url ＝ “https://account.rewardoo.com/api”
data ＝ “act=login&email=” ＋ 编码_URL编码 (user, 真, ) ＋ “&password=” ＋ 编码_URL编码 (pass, 真, )
resp ＝ 网页_访问S (url, 1, data, , cookie, , , , , , , , , , , , , , , , )
.如果真 (寻找文本 (resp, “success login”, , 假) ≠ -1)
    url ＝ “https://account.rewardoo.com/select”
    resp ＝ 网页_访问S (url, 0, , cookie, , , , , , , , , , , , , , , , , )
    url ＝ 文本_取出中间文本 (resp, #rwbj1, #引号, , )  ' 选择
    网页_访问S (url, , , cookie, cookie, , , 真, , , , , , , , , , 真, , , )
    返回 (cookie)
.如果真结束
调试输出 (resp)
返回 (“”)





.子程序 登录_LB, 文本型, , cookie带上auth_token即可
.参数 user, 文本型
.参数 pass, 文本型
.局部变量 json, 类_json
.局部变量 header, 文本型
.局部变量 url, 文本型
.局部变量 data, 文本型
.局部变量 i1, 整数型
.局部变量 resp, 文本型
.局部变量 auth_token, 文本型
.局部变量 cookie, 文本型

url ＝ “https://www.linkbux.com/api.php?mod=link_int&op=login”
data ＝ “lang=en&type=0&uname=” ＋ 编码_URL编码 (user, 真, ) ＋ “&password=” ＋ 编码_URL编码 (pass, 真, ) ＋ “&platform=&platform_code=”
resp ＝ 网页_访问S (url, 1, data, , cookie, , , , , , , , , , , , , , , , )
.如果真 (寻找文本 (resp, #lbsuc1, , 假) ≠ -1)
    json.解析 (resp, , )
    auth_token ＝ json.取通用属性 (“payload.auth_token”, )
    返回 (“auth_token=” ＋ auth_token)
.如果真结束
调试输出 (cookie)
返回 (“”)

.子程序 取订单数据到数组_LH
.参数 参_token, 文本型
.参数 参_begin_date, 文本型
.参数 参_end_date, 文本型
.参数 参_数组, 统计数据, 参考 数组
.参数 参_联盟, 文本型
.局部变量 局_数据, 统计数据
.局部变量 局_文本, 文本型
.局部变量 局_网址, 文本型
.局部变量 局_post, 文本型
.局部变量 局_head, 文本型
.局部变量 局_json, 类_json
.局部变量 局_成员数, 整数型
.局部变量 局_计次, 整数型
.局部变量 sign, 文本型
.局部变量 sz1, 文本型, , "0"
.局部变量 page, 文本型
.局部变量 page_size, 文本型
.局部变量 export, 文本型

局_head ＝ “Lh-Authorization: ” ＋ 参_token
page ＝ “1”
page_size ＝ “2000”
export ＝ “0”
.计次循环首 (10, )
    ' 局_网址 ＝ “https://www.linkhaitao.com/api.php?mod=medium&op=cashback2&token=” ＋ 参_token ＋ “&begin_date=” ＋ 参_begin_date ＋ “&end_date=” ＋ 参_end_date ＋ “&page=1&per_page=40000”
    局_网址 ＝ “https://www.linkhaitao.com/api2.php?c=report&a=performance”
    sign ＝ getSign (“m_id” ＋ 参_begin_date ＋ 参_end_date ＋ page ＋ page_size ＋ export)
    局_post ＝ “sign=” ＋ sign ＋ “&group_by=m_id&start_date=” ＋ 参_begin_date ＋ “&end_date=” ＋ 参_end_date ＋ “&page=” ＋ page ＋ “&page_size=” ＋ page_size ＋ “&export=” ＋ export
    局_文本 ＝ 网页_访问S (局_网址, 1, 局_post, , , 局_head, , , , , , , , , , , , , , , )
    .如果真 (寻找文本 (局_文本, #lhsuc1, , 假) ＞ 0)
        跳出循环 ()
    .如果真结束
    处理事件 ()
.计次循环尾 ()
局_json.解析 (局_文本, , )
局_成员数 ＝ 局_json.成员数 (“payload.info”)

.计次循环首 (局_成员数, 局_计次)
    局_数据.商家mid ＝ 局_json.取通用属性 (“payload.info[” ＋ 到文本 (局_计次 － 1) ＋ “].mcid”, )
    局_数据.佣金 ＝ 局_json.取通用属性 (“payload.info[” ＋ 到文本 (局_计次 － 1) ＋ “].cps_total_aff”, )
    局_数据.佣金 ＝ 子文本替换 (局_数据.佣金, “,”, , , , 真)
    局_数据.佣金 ＝ 数值到格式文本 (到数值 (局_数据.佣金), 2, 假)
    局_数据.佣金状态 ＝ “Pending”
    局_数据.联盟点击 ＝ 局_json.取通用属性 (“payload.info[” ＋ 到文本 (局_计次 － 1) ＋ “].click_num”, )
    局_数据.订单 ＝ 局_json.取通用属性 (“payload.info[” ＋ 到文本 (局_计次 － 1) ＋ “].cps_total_order”, )
    局_数据.联盟 ＝ 参_联盟
    加入成员 (参_数组, 局_数据)
    透明标签1.标题 ＝ “状态：正在获取联盟佣金数据中...” ＋ 局_数据.商家mid ＋ “佣金：” ＋ 局_数据.佣金
    处理事件 ()
.计次循环尾 ()
返回 ()





.子程序 取拒付佣金数据
.参数 参_开始日期, 文本型
.参数 参_结束日期, 文本型
.参数 参_佣金数组, 佣金记录, 参考 数组
.参数 参_汇总数组, 统计数据, 参考 数组
.局部变量 局_项数组s, 文本型, , "0"
.局部变量 局_值数组s, 文本型, , "0"
.局部变量 局_计次, 整数型
.局部变量 局_表格数据, 文本型
.局部变量 局_联盟, 文本型
.局部变量 局_token, 文本型

集_配置项.枚举项 (取运行目录 () ＋ “\config.ini”, “aff”, 局_项数组s, 局_值数组s, )
清除数组 (参_佣金数组)
.计次循环首 (取数组成员数 (登录数组), 局_计次)
    .判断开始 (寻找文本 (登录数组 [局_计次].lmurl, “linkhaitao.com”, , 假) ＞ 0)
        取拒付佣金数据到数组_LH (登录数组 [局_计次].token, 参_开始日期, 参_结束日期, 参_佣金数组, 登录数组 [局_计次].lmname)
        取拒付金额汇总到数组_LH (参_佣金数组, 参_汇总数组, 登录数组 [局_计次].lmname)
    .判断 (寻找文本 (登录数组 [局_计次].lmurl, “linkbux.com”, , 假) ＞ 0)
        取订单数据到数组_LB (登录数组 [局_计次].cookies, 参_开始日期, 参_结束日期, 参_佣金数组, 登录数组 [局_计次].lmname)
    .判断 (寻找文本 (登录数组 [局_计次].lmurl, “partnermatic.com”, , 假) ＞ 0)
        取订单数据到数组_PM (登录数组 [局_计次].token, 参_开始日期, 参_结束日期, 参_佣金数组, 登录数组 [局_计次].lmname)
    .判断 (寻找文本 (登录数组 [局_计次].lmurl, “rewardoo.com”, , 假) ＞ 0)
        取订单数据到数组_RW (登录数组 [局_计次].cookies, 参_开始日期, 参_结束日期, 参_佣金数组, 登录数组 [局_计次].lmname)
    .默认

    .判断结束

    处理事件 ()
.计次循环尾 ()
返回 ()


.子程序 取拒付佣金数据到数组_LH, 整数型
.参数 参_token, 文本型
.参数 参_begin_date, 文本型, 参考
.参数 参_end_date, 文本型
.参数 参_数组, 佣金记录, 参考 数组
.参数 参_联盟, 文本型
.局部变量 局_数据, 佣金记录
.局部变量 局_文本, 文本型
.局部变量 局_网址, 文本型
.局部变量 局_post, 文本型
.局部变量 局_head, 文本型
.局部变量 局_json, 类_json
.局部变量 局_成员数, 整数型
.局部变量 局_计次, 整数型
.局部变量 sign, 文本型
.局部变量 sz1, 文本型, , "0"
.局部变量 page, 文本型
.局部变量 page_size, 文本型
.局部变量 export, 文本型
.局部变量 status, 文本型

局_head ＝ “Lh-Authorization: ” ＋ 参_token
参_begin_date ＝ 时间_到文本 (增减时间 (到时间 (参_end_date), #月份, -3), 1, 1, )
status ＝ “expired”
page ＝ “1”
page_size ＝ “2000”
export ＝ “0”
.计次循环首 (10, )
    局_网址 ＝ “https://www.linkhaitao.com/api2.php?c=report&a=transactionDetail”
    sign ＝ getSign (参_begin_date ＋ 参_end_date ＋ status ＋ page ＋ page_size ＋ export)
    局_post ＝ “sign=” ＋ sign ＋ “&start_date=” ＋ 参_begin_date ＋ “&end_date=” ＋ 参_end_date ＋ “&status=” ＋ status ＋ “&page=” ＋ page ＋ “&page_size=” ＋ page_size ＋ “&export=” ＋ export
    局_文本 ＝ 网页_访问S (局_网址, 1, 局_post, , , 局_head, , , , , , , , , , , , , , , )
    .如果真 (寻找文本 (局_文本, #lhsuc1, , 假) ＞ 0)
        跳出循环 ()
    .如果真结束
    处理事件 ()
.计次循环尾 ()
局_json.解析 (局_文本, , )
局_成员数 ＝ 局_json.成员数 (“payload.info”)
' 写到文件 (“c:\09161.txt”, 到字节集 (局_文本))
.计次循环首 (局_成员数, 局_计次)
    局_数据.商家编号 ＝ 局_json.取通用属性 (“payload.info[” ＋ 到文本 (局_计次 － 1) ＋ “].mcid”, )
    局_数据.商家名称 ＝ 局_json.取通用属性 (“payload.info[” ＋ 到文本 (局_计次 － 1) ＋ “].m_id”, )
    局_数据.订单日期 ＝ 局_json.取通用属性 (“payload.info[” ＋ 到文本 (局_计次 － 1) ＋ “].updated_date”, )
    局_数据.佣金金额 ＝ 局_json.取通用属性 (“payload.info[” ＋ 到文本 (局_计次 － 1) ＋ “].total_cmsn”, )
    局_数据.佣金类型 ＝ “Rejected”
    局_数据.联盟简称 ＝ 参_联盟
    加入成员 (参_数组, 局_数据)
    透明标签1.标题 ＝ “状态：正在获取拒付佣金数据中...” ＋ 局_数据.商家mid ＋ “佣金：” ＋ 局_数据.佣金
    处理事件 ()
.计次循环尾 ()
返回 (取数组成员数 (参_数组))




.子程序 取拒付金额汇总到数组_LH, 整数型
.参数 参_佣金数组, 佣金记录, 数组
.参数 参_广告数组, 统计数据, 参考 数组
.参数 参_联盟, 文本型
.局部变量 局_商家编号s, 文本型, , "0"
.局部变量 局_计次, 整数型
.局部变量 局_计次2, 整数型
.局部变量 局_佣金1, 小数型

.计次循环首 (取数组成员数 (参_广告数组), 局_计次)
    .如果真 (参_广告数组 [局_计次].联盟 ＝ 参_联盟)
        局_佣金1 ＝ 0
        .计次循环首 (取数组成员数 (参_佣金数组), 局_计次2)
            .如果真 (参_佣金数组 [局_计次2].商家编号 ＝ 参_广告数组 [局_计次].商家mid)
                局_佣金1 ＝ 局_佣金1 ＋ 参_佣金数组 [局_计次2].佣金金额
            .如果真结束

        .计次循环尾 ()
        参_广告数组 [局_计次].佣金失效 ＝ 数值到格式文本 (局_佣金1, 2, 假)

    .如果真结束

.计次循环尾 ()
返回 (取数组成员数 (参_广告数组))





.子程序 取订单数据到数组_LH拒付
.参数 参_token, 文本型
.参数 参_begin_date, 文本型, 参考
.参数 参_end_date, 文本型
.参数 参_数组, 佣金记录, 参考 数组
.参数 参_联盟, 文本型
.局部变量 局_数据1s, 佣金记录, , "0"
.局部变量 局_文本s, 文本型, , "0"
.局部变量 局_数据, 佣金记录
.局部变量 局_文本, 文本型
.局部变量 局_网址, 文本型
.局部变量 局_post, 文本型
.局部变量 局_head, 文本型
.局部变量 局_json, 类_json
.局部变量 局_成员数, 整数型
.局部变量 局_计次, 整数型
.局部变量 sign, 文本型
.局部变量 sz1, 文本型, , "0"
.局部变量 page, 文本型
.局部变量 page_size, 文本型
.局部变量 export, 文本型
.局部变量 status, 文本型

局_head ＝ “Lh-Authorization: ” ＋ 参_token
参_begin_date ＝ 时间_到文本 (增减时间 (到时间 (参_end_date), #月份, -3), 1, 1, )
status ＝ “expired”
page ＝ “1”
page_size ＝ “2000”
export ＝ “0”
.计次循环首 (10, )
    局_网址 ＝ “https://www.linkhaitao.com/api2.php?c=report&a=transactionDetail”
    sign ＝ getSign (参_begin_date ＋ 参_end_date ＋ status ＋ page ＋ page_size ＋ export)
    局_post ＝ “sign=” ＋ sign ＋ “&start_date=” ＋ 参_begin_date ＋ “&end_date=” ＋ 参_end_date ＋ “&status=” ＋ status ＋ “&page=” ＋ page ＋ “&page_size=” ＋ page_size ＋ “&export=” ＋ export
    局_文本 ＝ 网页_访问S (局_网址, 1, 局_post, , , 局_head, , , , , , , , , , , , , , , )
    .如果真 (寻找文本 (局_文本, #lhsuc1, , 假) ＞ 0)
        跳出循环 ()
    .如果真结束
    处理事件 ()
.计次循环尾 ()
局_json.解析 (局_文本, , )
局_成员数 ＝ 局_json.成员数 (“payload.info”)
写到文件 (“c:\09161.txt”, 到字节集 (局_文本))
.计次循环首 (局_成员数, 局_计次)
    局_数据.商家编号 ＝ 局_json.取通用属性 (“payload.info[” ＋ 到文本 (局_计次 － 1) ＋ “].mcid”, )
    局_数据.商家名称 ＝ 局_json.取通用属性 (“payload.info[” ＋ 到文本 (局_计次 － 1) ＋ “].m_id”, )
    局_数据.订单日期 ＝ 局_json.取通用属性 (“payload.info[” ＋ 到文本 (局_计次 － 1) ＋ “].updated_date”, )
    局_数据.佣金金额 ＝ 局_json.取通用属性 (“payload.info[” ＋ 到文本 (局_计次 － 1) ＋ “].total_cmsn”, )
    局_数据.佣金类型 ＝ “Rejected”
    局_数据.联盟简称 ＝ 参_联盟
    加入成员 (局_数据1s, 局_数据)
    加入成员(j)
    透明标签1.标题 ＝ “状态：正在获取联盟佣金数据中...” ＋ 局_数据.商家mid ＋ “佣金：” ＋ 局_数据.佣金
    处理事件 ()
.计次循环尾 ()
返回 ()


.子程序 取订单数据到数组_PM
.参数 参_token, 文本型
.参数 参_begin_date, 文本型
.参数 参_end_date, 文本型
.参数 参_数组, 统计数据, 参考 数组
.参数 参_联盟, 文本型
.局部变量 局_数据, 统计数据
.局部变量 局_文本, 文本型
.局部变量 局_网址, 文本型
.局部变量 局_post, 文本型
.局部变量 局_json, 类_json
.局部变量 局_成员数, 整数型
.局部变量 局_计次, 整数型
.局部变量 局_时间戳, 文本型

局_网址 ＝ “https://api.partnermatic.com/report/performance”
.计次循环首 (10, )
    局_post ＝ “{” ＋ #引号 ＋ “appId” ＋ #引号 ＋ “:32,” ＋ #引号 ＋ “req” ＋ #引号 ＋ “:{” ＋ #引号 ＋ “header” ＋ #引号 ＋ “:{” ＋ #引号 ＋ “token” ＋ #引号 ＋ “:” ＋ #引号 ＋ 参_token ＋ #引号 ＋ “},” ＋ #引号 ＋ “fields” ＋ #引号 ＋ “:[],” ＋ #引号 ＋ “attributes” ＋ #引号 ＋ “:{},” ＋ #引号 ＋ “filter” ＋ #引号 ＋ “:{” ＋ #引号 ＋ “start_date” ＋ #引号 ＋ “:” ＋ #引号 ＋ 参_begin_date ＋ #引号 ＋ “,” ＋ #引号 ＋ “end_date” ＋ #引号 ＋ “:” ＋ #引号 ＋ 参_end_date ＋ #引号 ＋ “,” ＋ #引号 ＋ “dimension” ＋ #引号 ＋ “:” ＋ #引号 ＋ “mcid” ＋ #引号 ＋ “,” ＋ #引号 ＋ “medium_id” ＋ #引号 ＋ “:” ＋ #引号 ＋ “” ＋ #引号 ＋ “,” ＋ #引号 ＋ “brand_name” ＋ #引号 ＋ “:” ＋ #引号 ＋ “” ＋ #引号 ＋ “,” ＋ #引号 ＋ “tag” ＋ #引号 ＋ “:” ＋ #引号 ＋ “” ＋ #引号 ＋ “,” ＋ #引号 ＋ “status” ＋ #引号 ＋ “:” ＋ #引号 ＋ “” ＋ #引号 ＋ “,” ＋ #引号 ＋ “sort_field” ＋ #引号 ＋ “:” ＋ #引号 ＋ “cashback_sum” ＋ #引号 ＋ “,” ＋ #引号 ＋ “sort_order” ＋ #引号 ＋ “:” ＋ #引号 ＋ “desc” ＋ #引号 ＋ “,” ＋ #引号 ＋ “page_num” ＋ #引号 ＋ “:1,” ＋ #引号 ＋ “page_size” ＋ #引号 ＋ “:2000,” ＋ #引号 ＋ “export” ＋ #引号 ＋ “:0},” ＋ #引号 ＋ “page” ＋ #引号 ＋ “:{” ＋ #引号 ＋ “number” ＋ #引号 ＋ “:1,” ＋ #引号 ＋ “size” ＋ #引号 ＋ “:10}}}”
    局_文本 ＝ 网页_访问S (局_网址, 1, 局_post, , , “content-type: application/json”, , , , , , , , , , , , , , , )
    .如果真 (寻找文本 (局_文本, #pmsuc, , 假) ＞ 0)
        跳出循环 ()
    .如果真结束
    处理事件 ()
.计次循环尾 ()
局_json.解析 (局_文本, , )
局_成员数 ＝ 局_json.成员数 (“data.list”)
.计次循环首 (局_成员数, 局_计次)
    局_数据.商家mid ＝ 局_json.取通用属性 (“data.list[” ＋ 到文本 (局_计次 － 1) ＋ “].mid”, )
    局_数据.日期 ＝ 参_end_date
    局_数据.佣金 ＝ 局_json.取通用属性 (“data.list[” ＋ 到文本 (局_计次 － 1) ＋ “].cashback_sum”, )
    局_数据.佣金状态 ＝ “Pending”
    局_数据.联盟点击 ＝ 局_json.取通用属性 (“data.list[” ＋ 到文本 (局_计次 － 1) ＋ “].click_cnt”, )
    局_数据.订单 ＝ 局_json.取通用属性 (“data.list[” ＋ 到文本 (局_计次 － 1) ＋ “].order_cnt”, )
    局_数据.联盟 ＝ 参_联盟
    加入成员 (参_数组, 局_数据)
    透明标签1.标题 ＝ “状态：正在获取联盟佣金数据中...” ＋ 局_数据.商家mid ＋ “佣金：” ＋ 局_数据.佣金
    处理事件 ()
.计次循环尾 ()
返回 ()




.子程序 取订单数据到数组_LB
.参数 参_cookie, 文本型
.参数 参_begin_date, 文本型
.参数 参_end_date, 文本型
.参数 参_数组, 统计数据, 参考 数组
.参数 参_联盟, 文本型
.局部变量 局_数组, 文本型, , "0"
.局部变量 局_数据, 统计数据
.局部变量 局_文本, 文本型
.局部变量 局_网址, 文本型
.局部变量 局_post, 文本型
.局部变量 局_json, 类_json
.局部变量 局_成员数, 整数型
.局部变量 局_计次, 整数型
.局部变量 局_商家, 文本型
.局部变量 局_文本2, 文本型
.局部变量 局_文本3, 文本型
.局部变量 begin_date, 文本型
.局部变量 end_date, 文本型

begin_date ＝ 时间_格式化 (到时间 (参_begin_date), “MM-dd-yyyy”, , , )
end_date ＝ 时间_格式化 (到时间 (参_end_date), “MM-dd-yyyy”, , , )
.计次循环首 (10, )
    局_网址 ＝ “https://www.linkbux.com/publisher/reports/performance/cpsa?date_type=1&startdate=” ＋ begin_date ＋ “&enddate=” ＋ end_date ＋ “&date_range=” ＋ begin_date ＋ “&date_range=” ＋ end_date ＋ “&page=1&per_page=2000&status=pending&group_by2=m_id”
    局_文本 ＝ 网页_访问S (局_网址, 0, , 参_cookie, , , , , , , , , , , , , , , , , )
    .如果真 (文本_取中间_批量 (局_文本, “,show_mid:”, “},”, 局_数组, , , , , , , ) ＞ 0)
        跳出循环 ()
    .如果真结束
    处理事件 ()
.计次循环尾 ()

.计次循环首 (取数组成员数 (局_数组), 局_计次)
    局_数据.商家mid ＝ 文本_取出中间文本 (局_数组 [局_计次], #引号, #引号, , )
    局_商家 ＝ 文本_取出中间文本 (局_数组 [局_计次], “&m_id=”, #引号, , )
    .计次循环首 (10, )
        局_网址 ＝ “https://www.linkbux.com/publisher/reports/performance/cpsa?date_type=1&startdate=” ＋ begin_date ＋ “&enddate=” ＋ end_date ＋ “&date_range=” ＋ begin_date ＋ “&date_range=” ＋ end_date ＋ “&page=1&per_page=2000&status=pending&group_by2=m_id&m_id=” ＋ 局_商家 ＋ “&total=0”
        局_文本2 ＝ 网页_访问S (局_网址, 0, , 参_cookie, , , , , , , , , , , , , , , , , )
        局_文本3 ＝ 文本_取出中间文本 (局_文本2, “<h4>Total”, “<span>Export<”, , )
        .如果真 (局_文本3 ≠ “”)
            跳出循环 ()
        .如果真结束
        处理事件 ()
    .计次循环尾 ()
    局_数据.日期 ＝ 参_end_date
    局_数据.佣金状态 ＝ “Pending”
    局_数据.联盟 ＝ 参_联盟
    局_数据.佣金 ＝ 文本_取出中间文本 (局_文本3, “Commission<”, “/p>”, , )
    局_数据.佣金 ＝ 文本_取出中间文本 (局_数据.佣金, “>$”, “<”, , )
    局_数据.佣金 ＝ 子文本替换 (局_数据.佣金, “,”, , , , 真)
    局_数据.佣金 ＝ 数值到格式文本 (到数值 (局_数据.佣金), 2, 假)
    局_数据.联盟点击 ＝ 数值到格式文本 (到数值 (文本_取出中间文本 (局_文本3, “<p>”, “</p>”, , )), 0, 假)
    局_数据.订单 ＝ 文本_取出中间文本 (局_文本3, “Sales<”, “/p>”, , )
    局_数据.订单 ＝ 数值到格式文本 (到数值 (文本_取出中间文本 (局_数据.佣金, “<p>”, “<”, , )), 0, 假)
    加入成员 (参_数组, 局_数据)
    透明标签1.标题 ＝ “状态：正在获取联盟佣金数据中...” ＋ 局_数据.商家mid ＋ “佣金：” ＋ 局_数据.佣金
    处理事件 ()
.计次循环尾 ()
返回 ()


.子程序 取订单数据到数组_RW
.参数 参_cookie, 文本型
.参数 参_begin_date, 文本型
.参数 参_end_date, 文本型
.参数 参_数组, 统计数据, 参考 数组
.参数 参_联盟, 文本型
.局部变量 局_数据, 统计数据
.局部变量 局_文本, 文本型
.局部变量 局_网址, 文本型
.局部变量 局_user, 文本型
.局部变量 局_post, 文本型
.局部变量 局_json, 类_json
.局部变量 局_成员数, 整数型
.局部变量 局_计次, 整数型
.局部变量 局_时间戳, 文本型

' 以下代码为取出佣金数据
局_user ＝ 文本_取出中间文本 (参_cookie, “login_site=”, “.rewardoo”, , )
局_网址 ＝ “https://www.rewardoo.com/” ＋ 局_user ＋ “/creator/orders/performance_list”
.计次循环首 (10, )
    局_post ＝ “{” ＋ #引号 ＋ “export” ＋ #引号 ＋ “:0,” ＋ #引号 ＋ “date_type” ＋ #引号 ＋ “:” ＋ #引号 ＋ “transaction_date” ＋ #引号 ＋ “,” ＋ #引号 ＋ “begin_date” ＋ #引号 ＋ “:” ＋ #引号 ＋ 参_begin_date ＋ “ 00:00:01” ＋ #引号 ＋ “,” ＋ #引号 ＋ “end_date” ＋ #引号 ＋ “:” ＋ #引号 ＋ 参_end_date ＋ “ 23:59:59” ＋ #引号 ＋ “,” ＋ #引号 ＋ “page” ＋ #引号 ＋ “:1,” ＋ #引号 ＋ “page_size” ＋ #引号 ＋ “:2000,” ＋ #引号 ＋ “sort_by” ＋ #引号 ＋ “:” ＋ #引号 ＋ “” ＋ #引号 ＋ “,” ＋ #引号 ＋ “sort” ＋ #引号 ＋ “:” ＋ #引号 ＋ “” ＋ #引号 ＋ “,” ＋ #引号 ＋ “group_by” ＋ #引号 ＋ “:” ＋ #引号 ＋ “day” ＋ #引号 ＋ “,” ＋ #引号 ＋ “sort_by_key_metrics” ＋ #引号 ＋ “:” ＋ #引号 ＋ “mcid” ＋ #引号 ＋ “}”
    局_文本 ＝ 网页_访问S (局_网址, 1, 局_post, 参_cookie, , , , , , , , , , , , , , , , , )
    .如果真 (寻找文本 (局_文本, #rwbj1, , 假) ＞ 0)
        跳出循环 ()
    .如果真结束
    处理事件 ()
.计次循环尾 ()
局_json.解析 (局_文本, , )
局_成员数 ＝ 局_json.成员数 (“data.list”)
.计次循环首 (局_成员数, 局_计次)
    局_数据.商家mid ＝ 局_json.取通用属性 (“data.list[” ＋ 到文本 (局_计次 － 1) ＋ “].merchantId”, )
    局_数据.日期 ＝ 参_end_date
    局_数据.佣金 ＝ 局_json.取通用属性 (“data.list[” ＋ 到文本 (局_计次 － 1) ＋ “].cashbackSum”, )
    局_数据.佣金 ＝ 子文本替换 (局_数据.佣金, “$”, , , , 真)
    局_数据.佣金 ＝ 数值到格式文本 (到数值 (局_数据.佣金), 2, 假)
    局_数据.佣金状态 ＝ “Pending”
    局_数据.联盟点击 ＝ 局_json.取通用属性 (“data.list[” ＋ 到文本 (局_计次 － 1) ＋ “].clickCnt”, )
    局_数据.订单 ＝ 局_json.取通用属性 (“data.list[” ＋ 到文本 (局_计次 － 1) ＋ “].orderCnt”, )
    局_数据.联盟 ＝ 参_联盟
    加入成员 (参_数组, 局_数据)
    透明标签1.标题 ＝ “状态：正在获取联盟佣金数据中...” ＋ 局_数据.商家mid ＋ “佣金：” ＋ 局_数据.佣金
    处理事件 ()
.计次循环尾 ()
返回 ()


.子程序 合并当日佣金数据
.参数 参_数组, 统计数据, 参考 数组
.局部变量 局_合并数组, 统计数据, , "0"
.局部变量 局_数据, 统计数据
.局部变量 局_文本, 文本型
.局部变量 局_网址, 文本型
.局部变量 局_json, 类_json
.局部变量 局_天数, 整数型
.局部变量 局_计次, 整数型
.局部变量 局_计次2, 整数型
.局部变量 局_mid, 文本型
.局部变量 局_uid, 文本型
.局部变量 局_日期, 文本型
.局部变量 局_佣金, 文本型
.局部变量 局_佣金状态, 文本型
.局部变量 局_合并索引, 整数型

.计次循环首 (取数组成员数 (参_数组), 局_计次)
    局_数据.日期 ＝ 参_数组 [局_计次].日期
    局_数据.商家mid ＝ 参_数组 [局_计次].商家mid
    局_数据.佣金状态 ＝ 参_数组 [局_计次].佣金状态
    局_数据.uid ＝ 参_数组 [局_计次].uid
    局_数据.佣金 ＝ 参_数组 [局_计次].佣金
    .如果 (局_数据.佣金状态 ＝ “expired” 或 到大写 (局_数据.佣金状态) ＝ “CANCELED”)
        局_数据.佣金失效 ＝ 参_数组 [局_计次].佣金
    .否则

        局_数据.佣金失效 ＝ “0”
    .如果结束

    .如果真 (局_数据.uid ≠ “”)
        局_数据.佣金uid ＝ 参_数组 [局_计次].佣金
    .如果真结束


    局_合并索引 ＝ -1
    .计次循环首 (取数组成员数 (局_合并数组), 局_计次2)
        .如果真 (局_合并数组 [局_计次2].商家mid ＝ 局_数据.商家mid 且 局_合并数组 [局_计次2].日期 ＝ 局_数据.日期)
            局_合并索引 ＝ 局_计次2
            跳出循环 ()
        .如果真结束

    .计次循环尾 ()

    .如果 (局_合并索引 ＝ -1)
        加入成员 (局_合并数组, 局_数据)

    .否则

        局_合并数组 [局_合并索引].佣金 ＝ 数值到格式文本 (到数值 (局_合并数组 [局_合并索引].佣金) ＋ 到数值 (局_数据.佣金), 2, 假)
        局_合并数组 [局_合并索引].佣金失效 ＝ 数值到格式文本 (到数值 (局_合并数组 [局_合并索引].佣金失效) ＋ 到数值 (局_数据.佣金失效), 2, 假)
        局_合并数组 [局_合并索引].佣金uid ＝ 数值到格式文本 (到数值 (局_合并数组 [局_合并索引].佣金uid) ＋ 到数值 (局_数据.佣金uid), 2, 假)
    .如果结束

.计次循环尾 ()
复制数组 (参_数组, 局_合并数组)
返回 ()


.子程序 取表格数据到数组, 整数型, , 统计表格数据到统计数组
.参数 参_文本, 文本型
.参数 参_mcc, 文本型
.参数 参_数组, 统计数据, 参考 数组
.局部变量 局_统计数据, 统计数据
.局部变量 局_json, 类_json
.局部变量 局_成员数, 整数型
.局部变量 局_计次, 整数型
.局部变量 局_国家2, 文本型
.局部变量 局_国家s, 文本型, , "0"

局_json.解析 (参_文本, , )
局_成员数 ＝ 局_json.成员数 (“values”)
.计次循环首 (局_成员数 － 2, 局_计次)
    局_统计数据.账号mcc ＝ 参_mcc
    局_统计数据.账号cid ＝ 局_json.取通用属性 (“values[” ＋ 到文本 (局_计次 ＋ 1) ＋ “][12]”, )
    局_统计数据.广告系列 ＝ 局_json.取通用属性 (“values[” ＋ 到文本 (局_计次 ＋ 1) ＋ “][0]”, )
    局_国家2 ＝ 局_json.取通用属性 (“values[” ＋ 到文本 (局_计次 ＋ 1) ＋ “][1]”, )
    局_统计数据.国家 ＝ 取国家简写代码 (局_国家2)
    .如果真 (局_统计数据.国家 ＝ “” 且 寻找文本 (局_国家2, “;”, , 假) ＞ 0)
        局_国家s ＝ 分割文本 (局_国家2, “;”, )
        .如果真 (取数组成员数 (局_国家s) ＞ 0)
            局_统计数据.国家 ＝ 取国家简写代码 (局_国家s [1])
        .如果真结束

    .如果真结束
    局_统计数据.商家mid ＝ 文本_取右边 (局_统计数据.广告系列, “-”, , )
    局_统计数据.联盟 ＝ 到大写 (文本_取出中间文本 (局_统计数据.广告系列, “-”, “-”, , ))
    局_统计数据.域名 ＝ 取链接根域名 (局_json.取通用属性 (“values[” ＋ 到文本 (局_计次 ＋ 1) ＋ “][2]”, ))
    局_统计数据.预算 ＝ 局_json.取通用属性 (“values[” ＋ 到文本 (局_计次 ＋ 1) ＋ “][3]”, )
    局_统计数据.币种 ＝ 局_json.取通用属性 (“values[” ＋ 到文本 (局_计次 ＋ 1) ＋ “][4]”, )
    局_统计数据.日期 ＝ 局_json.取通用属性 (“values[” ＋ 到文本 (局_计次 ＋ 1) ＋ “][7]”, )
    局_统计数据.展示 ＝ 局_json.取通用属性 (“values[” ＋ 到文本 (局_计次 ＋ 1) ＋ “][8]”, )
    局_统计数据.广告点击 ＝ 局_json.取通用属性 (“values[” ＋ 到文本 (局_计次 ＋ 1) ＋ “][9]”, )
    局_统计数据.费用 ＝ 数值到格式文本 (到数值 (局_json.取通用属性 (“values[” ＋ 到文本 (局_计次 ＋ 1) ＋ “][10]”, )), 2, 假)
    加入成员 (参_数组, 局_统计数据)
    透明标签1.标题 ＝ “状态：正在获取谷歌表格广告数据中...” ＋ 局_统计数据.商家mid ＋ “广告费：” ＋ 局_统计数据.费用
.计次循环尾 ()
返回 (局_成员数)


.子程序 日期框_格式化, , , 处理日期框显示格式，无返回值。参数一：被格式化的日期框  参数二：格式化文本
.参数 日期框, 日期框, , 被格式化的日期框
.参数 文本格式, 文本型, , yyyy为年,MM为月,dd为日,HH为时,mm为分,ss为秒,ddd为周几,dddd为星期几,tt为上下午

日期框.发送信息 (4101, 0, 取变量数据地址 (文本格式))

.子程序 _超级按钮最近7天_被单击

日期框开始.今天 ＝ 增减时间 (取现行时间 (), #日, -6)
' 日期框结束.今天 ＝ 增减时间 (取现行时间 (), #日, -7)
日期框_格式化 (日期框开始, “yyyy-MM-dd”)
日期框_格式化 (日期框结束, “yyyy-MM-dd”)


.子程序 _超级按钮最近30天_被单击

日期框开始.今天 ＝ 增减时间 (取现行时间 (), #日, -29)
' 日期框结束.今天 ＝ 增减时间 (取现行时间 (), #日, -7)
日期框_格式化 (日期框开始, “yyyy-MM-dd”)
日期框_格式化 (日期框结束, “yyyy-MM-dd”)



.子程序 表格_获取数据, 文本型, , 读表格只要一个apikey就够了
.参数 参_表格链接, 文本型
.参数 参_表格范围, 文本型
.局部变量 局_访问令牌, 文本型
.局部变量 局_表格id, 文本型
.局部变量 局_响应数据, 文本型
.局部变量 局_API地址, 文本型

局_访问令牌 ＝ “AIzaSyA165t9ZWTyEAXDvHbJDLwHClkNn2w8684”
局_表格id ＝ 文本_取出中间文本 (参_表格链接, “/d/”, “/”, , )
局_API地址 ＝ “https://sheets.googleapis.com/v4/spreadsheets/” ＋ 局_表格id ＋ “/values/” ＋ 参_表格范围 ＋ “?key=” ＋ 局_访问令牌
局_响应数据 ＝ 编码_Utf8到Ansi (网页_访问_对象 (局_API地址, 0, , , , , , , , , , , , , , , , , ))
返回 (局_响应数据)





.子程序 取广告数据到数组2
.参数 参_开始日期, 文本型
.参数 参_结束日期, 文本型
.参数 参_合并数组, 统计数据, 参考 数组
.局部变量 广告系列, 文本型, , "0"
.局部变量 数据, 统计数据
.局部变量 局_计次, 整数型
.局部变量 局_计次2, 整数型
.局部变量 局_展示, 整数型
.局部变量 局_点击, 整数型
.局部变量 局_费用, 双精度小数型

.计次循环首 (取数组成员数 (集_广告数组), 局_计次)
    加入成员 (广告系列, 集_广告数组 [局_计次].广告系列)
.计次循环尾 ()
数组_去重复 (广告系列, )
数组_排序 (广告系列, , )
清除数组 (参_合并数组)
.计次循环首 (取数组成员数 (广告系列), 局_计次)
    局_费用 ＝ 0
    局_展示 ＝ 0
    局_点击 ＝ 0
    连续赋值 (“”, 数据.广告系列, 数据.账号mcc, 数据.账号cid, 数据.商家mid, 数据.联盟, 数据.预算, 数据.币种, 数据.展示, 数据.广告点击, 数据.费用)

    .计次循环首 (取数组成员数 (集_广告数组), 局_计次2)
        .如果真 (集_广告数组 [局_计次2].广告系列 ＝ 广告系列 [局_计次])
            .如果真 (取时间间隔 (到时间 (集_广告数组 [局_计次2].日期), 到时间 (参_开始日期), #日) ≥ 0 且 取时间间隔 (到时间 (集_广告数组 [局_计次2].日期), 到时间 (参_结束日期), #日) ≤ 0)
                局_费用 ＝ 局_费用 ＋ 到数值 (集_广告数组 [局_计次2].费用)
                局_展示 ＝ 局_展示 ＋ 到整数 (集_广告数组 [局_计次2].展示)
                局_点击 ＝ 局_点击 ＋ 到整数 (集_广告数组 [局_计次2].广告点击)
            .如果真结束

        .如果真结束
        透明标签1.标题 ＝ “状态：正在组合统计数据中...” ＋ 集_广告数组 [局_计次2].商家mid ＋ “预算” ＋ 集_广告数组 [局_计次2].预算
    .计次循环尾 ()
    .计次循环首 (取数组成员数 (集_广告数组), 局_计次2)
        .如果真 (集_广告数组 [局_计次2].广告系列 ＝ 广告系列 [局_计次])
            数据.广告系列 ＝ 集_广告数组 [局_计次2].广告系列
            数据.账号mcc ＝ 集_广告数组 [局_计次2].账号mcc
            数据.账号cid ＝ 集_广告数组 [局_计次2].账号cid
            数据.商家mid ＝ 集_广告数组 [局_计次2].商家mid
            数据.国家 ＝ 集_广告数组 [局_计次2].国家
            数据.联盟 ＝ 集_广告数组 [局_计次2].联盟
            数据.预算 ＝ 集_广告数组 [局_计次2].预算
            数据.币种 ＝ 集_广告数组 [局_计次2].币种
            数据.日期 ＝ 集_广告数组 [局_计次2].日期
            数据.展示 ＝ 到文本 (局_展示)
            数据.广告点击 ＝ 到文本 (局_点击)
            数据.费用 ＝ 到文本 (局_费用)
            .如果真 (数据.币种 ＝ “CNY”)
                数据.费用 ＝ 数值到格式文本 (到数值 (数据.费用) ÷ 7.15, 2, 假)
                数据.预算 ＝ 数值到格式文本 (到数值 (数据.预算) ÷ 7.15, 2, 假)

            .如果真结束

            跳出循环 ()
        .如果真结束

        透明标签1.标题 ＝ “状态：正在组合统计数据中...” ＋ 数据.商家mid ＋ “展示” ＋ 数据.展示
    .计次循环尾 ()
    .' 如果真 (取时间间隔 (到时间 (数据.日期), 到时间 (参_开始日期), #日) ≥ 0 且 取时间间隔 (到时间 (数据.日期), 到时间 (参_结束日期), #日) ≤ 0)
        ' 加入成员 (参_合并数组, 数据)
    .如果真结束

    .如果真 (到数值 (数据.展示) ＞ 0)
        加入成员 (参_合并数组, 数据)
    .如果真结束

.计次循环尾 ()
返回 ()




.子程序 取佣金数据到数组, 文本型
.参数 参_佣金数组, 统计数据, 数组
.参数 参_合并数组, 统计数据, 参考 数组
.局部变量 局_计次, 整数型
.局部变量 局_计次2, 整数型
.局部变量 累计费用, 双精度小数型
.局部变量 累计佣金, 双精度小数型

.计次循环首 (取数组成员数 (参_合并数组), 局_计次)
    .计次循环首 (取数组成员数 (参_佣金数组), 局_计次2)
        .如果真 (参_合并数组 [局_计次].商家mid ＝ 参_佣金数组 [局_计次2].商家mid)
            .如果真 (参_合并数组 [局_计次].联盟 ＝ 参_佣金数组 [局_计次2].联盟)
                参_合并数组 [局_计次].佣金 ＝ 参_佣金数组 [局_计次2].佣金
                参_合并数组 [局_计次].联盟点击 ＝ 参_佣金数组 [局_计次2].联盟点击
                参_合并数组 [局_计次].订单 ＝ 参_佣金数组 [局_计次2].订单
                参_合并数组 [局_计次].佣金状态 ＝ “Pending”
                调试输出 (参_合并数组 [局_计次].商家mid, 参_合并数组 [局_计次].联盟, 参_合并数组 [局_计次].佣金)
                跳出循环 ()

            .如果真结束

        .如果真结束
        透明标签1.标题 ＝ “状态：正在组合统计数据中...” ＋ 参_佣金数组 [局_计次2].商家mid ＋ “佣金” ＋ 参_佣金数组 [局_计次2].佣金
    .计次循环尾 ()
    累计费用 ＝ 累计费用 ＋ 到数值 (参_合并数组 [局_计次].费用)
    累计佣金 ＝ 累计佣金 ＋ 到数值 (参_合并数组 [局_计次].佣金)
.计次循环尾 ()
返回 (“累计广告费：” ＋ 数值到格式文本 (累计费用, 2, 假) ＋ “，累计佣金：” ＋ 数值到格式文本 (累计佣金, 2, 假) ＋ “，平均ROI：” ＋ 数值到格式文本 ((累计佣金 － 累计费用) ÷ 累计费用, 2, 假))




.子程序 取数组到列表框
.参数 参_数组, 统计数据, 数组
.局部变量 局_计次, 整数型
.局部变量 索引, 整数型
.局部变量 cash, 双精度小数型
.局部变量 roi, 双精度小数型
.局部变量 epc, 双精度小数型
.局部变量 cpc, 双精度小数型
.局部变量 cr, 双精度小数型
.局部变量 背景颜色, 整数型
.局部变量 文本颜色, 整数型
.局部变量 局_计次2, 整数型

背景颜色 ＝ 多项选择 (取随机数 (1, 3), #芙红, #黄色, #绿色)
文本颜色 ＝ 多项选择 (取随机数 (1, 3), #红色, #蓝色, #白色)
超级列表框统计报表.可视 ＝ 真
超级列表框统计报表.禁止 ＝ 假
超级列表框明细报表.可视 ＝ 假
超级列表框明细报表.禁止 ＝ 真
超级列表框统计报表.全部删除 ()
超级列表框统计报表.禁止重画 ()
.计次循环首 (取数组成员数 (参_数组), 局_计次)
    处理事件 ()
    索引 ＝ _启动窗口.超级列表框统计报表.插入表项 (, , , , , )
    _启动窗口.超级列表框统计报表.置标题 (索引, 0, 到文本 (索引 ＋ 1))
    _启动窗口.超级列表框统计报表.置标题 (索引, 1, 参_数组 [局_计次].账号mcc ＋ “$$” ＋ 参_数组 [局_计次].账号cid)
    _启动窗口.超级列表框统计报表.置标题 (索引, 2, 参_数组 [局_计次].广告系列)
    _启动窗口.超级列表框统计报表.置标题 (索引, 3, 参_数组 [局_计次].商家mid)
    _启动窗口.超级列表框统计报表.置标题 (索引, 4, 参_数组 [局_计次].预算)
    _启动窗口.超级列表框统计报表.置标题 (索引, 5, 到文本 (到整数 (参_数组 [局_计次].展示)))
    _启动窗口.超级列表框统计报表.置标题 (索引, 6, 到文本 (到整数 (参_数组 [局_计次].广告点击)))
    _启动窗口.超级列表框统计报表.置标题 (索引, 7, 参_数组 [局_计次].费用)
    _启动窗口.超级列表框统计报表.置标题 (索引, 8, 参_数组 [局_计次].佣金)
    epc ＝ 到数值 (参_数组 [局_计次].佣金) ÷ 到数值 (参_数组 [局_计次].广告点击)
    cpc ＝ 到数值 (参_数组 [局_计次].费用) ÷ 到数值 (参_数组 [局_计次].广告点击)
    roi ＝ (到数值 (参_数组 [局_计次].佣金) － 到数值 (参_数组 [局_计次].费用)) ÷ 到数值 (参_数组 [局_计次].费用)
    _启动窗口.超级列表框统计报表.置标题 (索引, 9, 数值到格式文本 (cpc, 2, 假))
    _启动窗口.超级列表框统计报表.置标题 (索引, 10, 数值到格式文本 (epc, 2, 假))
    _启动窗口.超级列表框统计报表.置标题 (索引, 11, 数值到格式文本 (roi, 2, 假))
.计次循环尾 ()
超级列表框统计报表.允许重画 ()
.计次循环首 (超级列表框统计报表.取表项数 (), 局_计次)
    roi ＝ 到数值 (超级列表框统计报表.取标题 (局_计次 － 1, 11))
    .如果真 (roi ＜ 0)
        .计次循环首 (12, 局_计次2)
            置行列颜色 (_启动窗口, 超级列表框统计报表, 局_计次 － 1, 局_计次2 － 1, #红色, #默认色)
        .计次循环尾 ()
    .如果真结束

.计次循环尾 ()
置色刷新 (超级列表框统计报表)
返回 ()


.子程序 _按钮数据统计_被单击
.局部变量 局_佣金数组, 统计数据, , "0"
.局部变量 局_广告数组, 统计数据, , "0"
.局部变量 局_统计数组, 统计数据, , "0"
.局部变量 局_拒付数组, 佣金记录, , "0"
.局部变量 局_开始日期, 文本型
.局部变量 局_结束日期, 文本型
.局部变量 统计文本, 文本型

.如果真 (超级列表框明细报表.可视 ＝ 真)
    超级列表框明细报表.可视 ＝ 假
    超级列表框明细报表.禁止 ＝ 真
    超级列表框统计报表.可视 ＝ 真
    超级列表框统计报表.禁止 ＝ 假
    返回 ()
.如果真结束

按钮数据统计.禁止 ＝ 真
透明标签1.标题 ＝ “状态：正在获取谷歌表格广告数据中...”
取谷歌表格数据 (集_广告数组)


透明标签1.标题 ＝ “状态：正在获取联盟佣金数据中...”
局_开始日期 ＝ 时间_到文本 (日期框开始.今天, 1, 1, )
局_结束日期 ＝ 时间_到文本 (日期框结束.今天, 1, 1, )
取联盟佣金数据 (局_开始日期, 局_结束日期, 局_佣金数组)
透明标签1.标题 ＝ “状态：正在组合统计数据中...”
取广告数据到数组2 (局_开始日期, 局_结束日期, 局_广告数组)
统计文本 ＝ 取佣金数据到数组 (局_佣金数组, 局_广告数组)
取拒付佣金数据 (局_开始日期, 局_结束日期, 局_拒付数组, 局_广告数组)

取数组到列表框 (局_广告数组)
透明标签1.标题 ＝ “最近” ＋ 到文本 (取时间间隔 (到时间 (局_结束日期), 到时间 (局_开始日期), #日) ＋ 1) ＋ “天” ＋ 统计文本
按钮数据统计.禁止 ＝ 假
返回 ()


.子程序 子程序1
.局部变量 i1, 整数型

.计次循环首 (取数组成员数 (集_广告数组), i1)
    .如果真 (寻找文本 (集_广告数组 [i1].广告系列, “oden”, , 假) ＞ 0)
        调试输出 (集_广告数组 [i1].广告系列)
        调试输出 (集_广告数组 [i1].广告系列)

    .如果真结束


.计次循环尾 ()

.子程序 取联盟佣金数据
.参数 参_开始日期, 文本型
.参数 参_结束日期, 文本型
.参数 参_统计数组, 统计数据, 参考 数组
.局部变量 局_项数组s, 文本型, , "0"
.局部变量 局_值数组s, 文本型, , "0"
.局部变量 局_计次, 整数型
.局部变量 局_表格数据, 文本型
.局部变量 局_联盟, 文本型
.局部变量 局_token, 文本型

集_配置项.枚举项 (取运行目录 () ＋ “\config.ini”, “aff”, 局_项数组s, 局_值数组s, )
清除数组 (参_统计数组)
.计次循环首 (取数组成员数 (登录数组), 局_计次)
    .判断开始 (寻找文本 (登录数组 [局_计次].lmurl, “linkhaitao.com”, , 假) ＞ 0)
        取订单数据到数组_LH拒付 (登录数组 [局_计次].token, 参_开始日期, 参_结束日期, 参_统计数组, 登录数组 [局_计次].lmname)
    .判断 (寻找文本 (登录数组 [局_计次].lmurl, “linkbux.com”, , 假) ＞ 0)
        取订单数据到数组_LB (登录数组 [局_计次].cookies, 参_开始日期, 参_结束日期, 参_统计数组, 登录数组 [局_计次].lmname)
    .判断 (寻找文本 (登录数组 [局_计次].lmurl, “partnermatic.com”, , 假) ＞ 0)
        取订单数据到数组_PM (登录数组 [局_计次].token, 参_开始日期, 参_结束日期, 参_统计数组, 登录数组 [局_计次].lmname)
    .判断 (寻找文本 (登录数组 [局_计次].lmurl, “rewardoo.com”, , 假) ＞ 0)
        取订单数据到数组_RW (登录数组 [局_计次].cookies, 参_开始日期, 参_结束日期, 参_统计数组, 登录数组 [局_计次].lmname)
    .默认

    .判断结束

    处理事件 ()
.计次循环尾 ()
返回 ()



.子程序 __启动窗口_将被销毁



.子程序 _按钮数据导出_被单击
.局部变量 tempfile, 文本型
.局部变量 局_开始日期, 文本型
.局部变量 局_结束日期, 文本型

局_开始日期 ＝ 时间_到文本 (日期框开始.今天, 1, 1, )
局_结束日期 ＝ 时间_到文本 (日期框结束.今天, 1, 1, )
tempfile ＝ 超级列表框_EXCEL_导出 (超级列表框统计报表, , , , , )
文件_复制 (tempfile, 取运行目录 () ＋ “\log\” ＋ 局_开始日期 ＋ “-” ＋ 局_结束日期 ＋ “.xlsx”, 0)


.子程序 _超级列表框统计报表_表头被单击
.参数 被单击列索引, 整数型
.局部变量 i, 整数型
.局部变量 n, 整数型
.局部变量 sy, 整数型

.如果真 (被单击列索引 ＜ 0)
    返回 ()
.如果真结束

.版本 2
.支持库 iext2

.程序集 工具_程序集

.子程序 提示
.参数 日志文本, 文本型
.参数 提示信息颜色, 整数型, 可空
.局部变量 格式, 字符格式
.局部变量 时间, 文本型

时间 ＝ 时间_到文本 (, 1, 3, )
.如果 (提示信息颜色 ＝ #黑色)  ' 0
    格式.文本颜色 ＝ #绿色  ' 65280‘255
.否则
    格式.文本颜色 ＝ 提示信息颜色
.如果结束


.子程序 取链接根域名, 文本型, , 提取域名
.参数 urls, 文本型
.局部变量 url1, 文本型

url1 ＝ 文本_取出中间文本 (urls, “//”, “/”)
.如果 (删全部空 (url1) ≠ “”)

.否则

    .如果 (寻找文本 (urls, “=”, , 假) ＞ 0)
        url1 ＝ 文本_取出中间文本 (urls, “//”, “?”)
    .否则

        url1 ＝ 文本_替换 (urls, , , , “https://”, “”, “http://”, “”, , , , , , )
    .如果结束

    .如果真 (寻找文本 (url1, “%2F”, , 假) ＞ 0)
        url1 ＝ 文本_取出中间文本 (“//” ＋ url1, “//”, “%2F”, , )
    .如果真结束


.如果结束

url1 ＝ 子文本替换 (url1, “www.”, , , , 真)
返回 (url1)


.子程序 取国家简写代码, 文本型
.参数 国家全称, 文本型
.局部变量 sz1, 文本型, , "0"
.局部变量 sz2, 文本型, , "0"
.局部变量 txt1, 文本型
.局部变量 i1, 整数型

sz1 ＝ 分割文本 (#国家简写, #换行符, )
.计次循环首 (取数组成员数 (sz1), i1)
    .如果真 (寻找文本 (sz1 [i1], 国家全称, , 假) ＞ 0)
        sz2 ＝ 分割文本 (sz1 [i1], “=”, )
        txt1 ＝ sz2 [1]
        跳出循环 ()
    .如果真结束

.计次循环尾 ()
返回 (txt1)




.子程序 getSign, 文本型
.参数 data, 文本型
.局部变量 salt, 文本型

salt ＝ “TSf03xGHykY”
返回 (校验_取md5 (到字节集 (data ＋ salt), , ))


.版本 2

.数据类型 统计数据
    .成员 账号mcc, 文本型
    .成员 账号cid, 文本型
    .成员 广告系列, 文本型
    .成员 商家mid, 文本型
    .成员 商家mcid, 文本型
    .成员 联盟, 文本型
    .成员 国家, 文本型
    .成员 域名, 文本型
    .成员 预算, 文本型
    .成员 币种, 文本型
    .成员 展示, 文本型
    .成员 广告点击, 文本型
    .成员 联盟点击, 文本型
    .成员 费用, 文本型
    .成员 佣金, 文本型
    .成员 佣金失效, 文本型
    .成员 佣金状态, 文本型
    .成员 佣金uid, 文本型
    .成员 uid, 文本型
    .成员 日期, 文本型
    .成员 订单, 文本型
    .成员 联盟链接, 文本型
    .成员 联盟token, 文本型
    .成员 次数, 文本型
    .成员 拒付率3月, 文本型

.数据类型 登录数据
    .成员 lmname, 文本型
    .成员 lmurl, 文本型
    .成员 user, 文本型
    .成员 pass, 文本型
    .成员 cookies, 文本型
    .成员 token, 文本型
    .成员 resp, 文本型

.数据类型 佣金记录
    .成员 联盟简称, 文本型
    .成员 商家编号, 文本型
    .成员 商家名称, 文本型
    .成员 订单日期, 日期时间型
    .成员 佣金金额, 小数型
    .成员 佣金类型, 文本型

.数据类型 汇总记录
    .成员 联盟简称, 文本型
    .成员 商家编号, 文本型
    .成员 商家名称, 文本型
    .成员 拒付合计, 小数型
    .成员 合计佣金, 小数型
    .成员 拒付率, 小数型
